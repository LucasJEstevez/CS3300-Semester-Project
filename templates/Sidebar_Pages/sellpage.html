{% extends "base.html" %}

{% block title %}Sell{% endblock %}

{% block content %}
<html>
<body>

    <h2>Sell Your Car!</h2>
    <h2 id="welcome_header"></h2>
    <br><br><br><br>
<div class = "fakeimg" style = "height:150px; background-color: rgba(17, 62, 145, 0.6); text-align: center;">
    <form method="post">
        <label for="vin">VIN:</label> 
        <input type="text" id="vin" name="vin" >

        <label for="make">Make:</label>
        <input type="text" id="make" name="make" >

        <label for="model">Model:</label>
        <input type="text" id="model" name="model" >

        <br>

        <label for="year">Year:</label>
        <input type="number" id="year" name="year" >

        <label for="miles2">Miles:</label>
        <input type="number" id="miles2" name="miles2" >

        <label for="Trim">Trim:</label>
        <input type="text" id="trim" name="trim" ><br>
    </form>
  <button type="submit" onclick="login()">Submit</button>
</div>

<script>
window.onload = function() {
    const token = localStorage.getItem("access_token");
    let loggedIn = false;
    console.log("Token (if=false):",token);

    if (token) {
        console.log('Token (if=true):', token);
        fetch('/isValidToken', {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`
            },
            body: JSON.stringify({ token: token }) // Convert body to JSON string
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            if (data.isValid) {
                loggedIn = true;
                document.getElementById("welcome_header").innerHTML = `Welcome, ${data.username}!`;
            } else {
                document.getElementById("welcome_header").innerHTML = 'Invalid token or user not found.';
            }
        })
        .catch(error => {
            console.error('Error during request:', error);
            document.getElementById("welcome_header").innerHTML = 'Request failed: ' + error.message;
        });
    } else {
        document.getElementById("welcome_header").innerHTML = 'No token found. Must be logged in to sell your car.';
        window.location.href = "/sign-in";
    }
}
function sell(){
    console.log("Hello");
}
</script>
</body>
</html>

{% endblock %}